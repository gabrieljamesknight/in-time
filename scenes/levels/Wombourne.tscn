[gd_scene load_steps=20 format=3 uid="uid://dt7646j6w321c"]

[ext_resource type="PackedScene" uid="uid://cbatlw163lxtd" path="res://scenes/player/player.tscn" id="1_player"]
[ext_resource type="PackedScene" uid="uid://cfsy6ply8s0it" path="res://scenes/interactables/interactive_bike.tscn" id="2_bike"]
[ext_resource type="PackedScene" uid="uid://dj4fstw2jeauk" path="res://scenes/hazards/traffic_car.tscn" id="3_car"]
[ext_resource type="PackedScene" uid="uid://dmaavs7g6v5" path="res://scenes/ui/hud.tscn" id="4_hud"]
[ext_resource type="Script" uid="uid://mratbeku5rp4" path="res://scripts/ui/hud.gd" id="5_hud_script"]
[ext_resource type="Script" uid="uid://fjupftl8kcbq" path="res://scripts/objects/mission_zone.gd" id="6_zone"]
[ext_resource type="PackedScene" uid="uid://dyvxp4rlmkc2k" path="res://scenes/hazards/mugger.tscn" id="7_mugger"]
[ext_resource type="Script" uid="uid://cgx2xahrsnogq" path="res://scripts/systems/traffic_manager.gd" id="8_traffic"]

[sub_resource type="ProceduralSkyMaterial" id="ProceduralSkyMaterial_flow"]
sky_top_color = Color(0.2, 0.5, 0.8, 1)
sky_horizon_color = Color(0.6, 0.7, 0.8, 1)
ground_bottom_color = Color(0.1, 0.2, 0.1, 1)
ground_horizon_color = Color(0.6, 0.7, 0.8, 1)

[sub_resource type="Sky" id="Sky_flow"]
sky_material = SubResource("ProceduralSkyMaterial_flow")

[sub_resource type="Environment" id="Environment_flow"]
background_mode = 2
sky = SubResource("Sky_flow")
ambient_light_source = 3
reflected_light_source = 2

[sub_resource type="NavigationMesh" id="NavigationMesh_Simple"]
vertices = PackedVector3Array(-99.5, 0.5, -99.5, -99.5, 0.5, 99.5, 99.5, 0.5, 99.5, 99.5, 0.5, -99.5)
polygons = [PackedInt32Array(3, 2, 0), PackedInt32Array(0, 2, 1)]
geometry_parsed_geometry_type = 1
geometry_source_geometry_mode = 1
geometry_source_group_name = &"nav_source"

[sub_resource type="StandardMaterial3D" id="Mat_Grass"]
albedo_color = Color(0.13, 0.55, 0.13, 1)

[sub_resource type="StandardMaterial3D" id="Mat_Sidewalk"]
albedo_color = Color(0.6, 0.6, 0.6, 1)

[sub_resource type="StandardMaterial3D" id="Mat_Road"]
albedo_color = Color(0.2, 0.2, 0.2, 1)

[sub_resource type="StandardMaterial3D" id="Mat_Building_Brick"]
albedo_color = Color(0.65, 0.25, 0.15, 1)

[sub_resource type="StandardMaterial3D" id="Mat_Building_White"]
albedo_color = Color(0.9, 0.9, 0.85, 1)

[sub_resource type="CylinderShape3D" id="CylinderShape3D_Zone"]
height = 4.0
radius = 4.0

[sub_resource type="Curve3D" id="Curve3D_MainRoad"]
_data = {
"points": PackedVector3Array(0, 0, 0, 0, 0, 0, -40, 1, 60, 0, 0, 0, 0, 0, 0, -40, 1, -40, 0, 0, 0, 0, 0, 0, 40, 1, -40, 0, 0, 0, 0, 0, 0, 40, 1, 60, 0, 0, 0, 0, 0, 0, 0, 1, 70, 0, 0, 0, 0, 0, 0, -40, 1, 60),
"tilts": PackedFloat32Array(0, 0, 0, 0, 0, 0)
}
point_count = 6

[node name="Wombourne" type="Node3D"]

[node name="WorldEnvironment" type="WorldEnvironment" parent="."]
environment = SubResource("Environment_flow")

[node name="DirectionalLight3D" type="DirectionalLight3D" parent="."]
transform = Transform3D(0.866025, -0.433013, 0.25, 0, 0.5, 0.866025, -0.5, -0.75, 0.433013, 0, 10, 0)
shadow_enabled = true

[node name="NavigationRegion3D" type="NavigationRegion3D" parent="."]
navigation_mesh = SubResource("NavigationMesh_Simple")

[node name="LevelGeometry" type="Node3D" parent="NavigationRegion3D"]

[node name="Floor_Grass" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry" groups=["nav_source"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, -0.5, 0)
use_collision = true
size = Vector3(200, 1, 200)
material = SubResource("Mat_Grass")

[node name="VillageGreen" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry" groups=["nav_source"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.2, 10)
size = Vector3(30, 0.5, 40)
material = SubResource("Mat_Grass")

[node name="CricketPitch" type="CSGCylinder3D" parent="NavigationRegion3D/LevelGeometry/VillageGreen" groups=["nav_source"]]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.1, 0)
radius = 5.0
height = 0.1
material = SubResource("Mat_Sidewalk")

[node name="Road_Loop" type="CSGCombiner3D" parent="NavigationRegion3D/LevelGeometry" groups=["nav_source"]]
use_collision = true

[node name="Road_West" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Road_Loop"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -40, 0.1, 10)
size = Vector3(15, 0.2, 120)
material = SubResource("Mat_Road")

[node name="Road_East" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Road_Loop"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 40, 0.1, 10)
size = Vector3(15, 0.2, 120)
material = SubResource("Mat_Road")

[node name="Road_North" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Road_Loop"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.1, -47.5)
size = Vector3(95, 0.2, 15)
material = SubResource("Mat_Road")

[node name="Road_South" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Road_Loop"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0.1, 67.5)
size = Vector3(95, 0.2, 15)
material = SubResource("Mat_Road")

[node name="Buildings" type="Node3D" parent="NavigationRegion3D/LevelGeometry"]

[node name="Shop_Row_1" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -55, 3, 0)
use_collision = true
size = Vector3(10, 6, 60)
material = SubResource("Mat_Building_Brick")

[node name="Shop_Row_2" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 55, 3, 20)
use_collision = true
size = Vector3(10, 6, 40)
material = SubResource("Mat_Building_White")

[node name="Pub" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 4, -65)
use_collision = true
size = Vector3(20, 8, 15)
material = SubResource("Mat_Building_Brick")

[node name="Sign" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings/Pub"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2, 8)
size = Vector3(4, 2, 1)
material = SubResource("Mat_Sidewalk")

[node name="AlleyWall_L" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -25, 2, -65)
use_collision = true
size = Vector3(20, 4, 10)
material = SubResource("Mat_Building_White")

[node name="AlleyWall_R" type="CSGBox3D" parent="NavigationRegion3D/LevelGeometry/Buildings"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 25, 2, -65)
use_collision = true
size = Vector3(20, 4, 10)
material = SubResource("Mat_Building_White")

[node name="Gameplay" type="Node3D" parent="."]

[node name="Player" parent="Gameplay" instance=ExtResource("1_player")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 1, 10)

[node name="Hud" parent="Gameplay" instance=ExtResource("4_hud")]
script = ExtResource("5_hud_script")

[node name="InteractiveBike" parent="Gameplay" instance=ExtResource("2_bike")]
transform = Transform3D(0.707107, 0, 0.707107, 0, 1, 0, -0.707107, 0, 0.707107, -10, 0.6, 15)

[node name="StartZone_Pub" type="Area3D" parent="Gameplay" node_paths=PackedStringArray("target_zone")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, -53)
script = ExtResource("6_zone")
mission_time = 40.0
target_zone = NodePath("../EndZone_Green")

[node name="CollisionShape3D" type="CollisionShape3D" parent="Gameplay/StartZone_Pub"]
shape = SubResource("CylinderShape3D_Zone")

[node name="Label3D" type="Label3D" parent="Gameplay/StartZone_Pub"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 2.5, 0)
text = "MISSION START"
font_size = 64

[node name="EndZone_Green" type="Area3D" parent="Gameplay"]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 10)
script = ExtResource("6_zone")
type = 1

[node name="CollisionShape3D" type="CollisionShape3D" parent="Gameplay/EndZone_Green"]
shape = SubResource("CylinderShape3D_Zone")

[node name="Hazards" type="Node3D" parent="."]

[node name="Mugger" parent="Hazards" instance=ExtResource("7_mugger")]
transform = Transform3D(1, 0, 0, 0, 1, 0, 0, 0, 1, -14, 1, -65)

[node name="TrafficSystem" type="Node" parent="Hazards" node_paths=PackedStringArray("traffic_paths")]
script = ExtResource("8_traffic")
car_scene = ExtResource("3_car")
traffic_paths = [NodePath("MainLoop")]
density = 30.0
speed_variance = 3.0

[node name="MainLoop" type="Path3D" parent="Hazards/TrafficSystem"]
curve = SubResource("Curve3D_MainRoad")
